<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shipping page | Paytm Mall'</title>
    <link rel="icon" href="logo/favicon.png" />
    <link rel="stylesheet" href="./address.css">
    <a id="home" href="./index.html"></a>

</head>
<style>

</style>

<body>
    <div id="nav"></div>

    <div id="forminp">
        <form id="form_ship">
            <div id="fship">
                <p class="ship_det">shiping Address</p>
                <label for="fname">First name</label><br />
                <input type="text" name="fname" id="fname" />
                <br />
                <label for="lname">Last name</label><br />
                <input type="text" name="lname" id="lname" />
                <br />
                <label for="add1">Address1</label><br />
                <input type="text" name="add1" id="add1" />
                <br />
                <label for="add2">Address2</label><br />
                <input type="text" name="add2" id="add2" />
                <br />
                <label for="zcode">Country</label><br />
                <input type="text" name="Country" id="country" />
                <br />
                <label for="zcode">Zip code</label><br />
                <input type="number" name="Zcode" id="zcode" />
                <br />
                <label for="num">Phone</label><br />
                <input type="number" name="num" id="num" />
                <br />
                <input type="checkbox" id="add_bill" name="add_bill" value="add_bill" />
                <label for="add_bill"> Use Address for Billing</label><br />
                <br>
                <input id="change" type="submit" value="Submit Address">
                
            </div>
        </form>
    </div>

    </div>



</body>

</html>
<!-- <script src="scripts/address.js"> -->
    <script>
        let home = document.getElementById("home")
document.querySelector("#form_ship").addEventListener("submit", shipping);
var paytm_Arr = JSON.parse(localStorage.getItem("address")) || [];

 let shipadd =document.getElementById("change");
 let name = document.getElementById("fname")
 shipadd.addEventListener("click",()=>{
    // home()
        alert("your order has been placed");
        window.location.href="./index.html"; 
 })
// function home(){
//     setInterval(()=>{
//        alert("home")
//     },2000);
// }
//  slideshowFun(movieImages[i])
// i++
//  setInterval(()=>{
//   if(i==movieImages.length ){
//     i=0
//   }
//   slideshowFun(movieImages[i])
//   i++
// },2000);
//********************cokies*********************************** */
const cookies = (name) => {
    
  // console.log(name);
  let tokenArr = document.cookie.split(";");
  // console.log(tokenArr);
  for (let i = 0; i < tokenArr.length; i++) {
    let subArr = tokenArr[i].split("=");
    // console.log(subArr[0]);
    if (subArr[0].trim() === name) {
      // console.log(subArr[1], "ram");
      return subArr[1];
    }
  }
};

//**************** fetch all data from backend ****************/

const fetchData = async (url) => {
  try {
    let res = await fetch(url);
    let data = await res.json();
    return data;
  } catch (error) {
    console.log(error.message);
  }
};

//********* fetch user id********** */

const disPlayName = async () => {
  let subArr = cookies("token");
  //   console.log("token", subArr);
  let res = await fetch("http://localhost:5901/user", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      // Authorization: `Bearer ${token}`,
      Authorization: `Bearer ${subArr}`,
    },
  });
  let data = await res.json();
  //   console.log(data);
  return data;
};

async function shipping(event) {
  event.preventDefault();
  var fName = document.querySelector("#fname").value;
  var lName = document.querySelector("#lname").value;
  var add1 = document.querySelector("#add1").value;
  var add2 = document.querySelector("#add2").value;
  var country = document.querySelector("#country").value;
  var zcode = document.querySelector("#zcode").value;
  var num = document.querySelector("#num").value;

  console.log(fName, lName, add1, add2, country, zcode, num);
  if (
    fName != "" &&
    lName != "" &&
    add1 != "" &&
    country != "" &&
    zcode != "" &&
    num != ""
    ) {
        try {
            let data = await disPlayName();
            let id = data.id;
            //********* */
            let res = await fetchData(`http://localhost:5901/userCartProduct/${id}`);
            //   console.log(res);
            res.map(async (el) => {
                try {
                    let userAddress = {
                        productId: el.productId,
                        first_name: fName,
                        last_name: lName,
                        address1: add1,
                        country: country,
                        zipcode: zcode,
                        mobile_no: num,
                    };
                    userAddress = JSON.stringify(userAddress);
                    let res = await fetch("http://localhost:5901/userAddress", {
                        method: "POST",
                        body: userAddress,
                        headers: {
                            "Content-Type": "application/json",
                        },
                    });
                    let data = await res.json();
                    console.log(data);
                } catch (error) {
            
          console.log(error);
        }
      });
    } catch (error) {
      console.log(error);
    }
    
 
  }
}

</script>